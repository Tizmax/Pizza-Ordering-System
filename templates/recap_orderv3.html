<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Recap</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .order-card {
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            padding: 15px;
            position: relative;
        }
        .order-card img {
            border-radius: 15px;
            width: 150px;
            height: 150px;
            object-fit: cover;
            margin-right: 15px;
        }
        .order-details {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .pizza-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .supplement, .excluded-ingredient {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .supplement {
            background-color: #28a745;
            color: white;
        }
        .excluded-ingredient {
            background-color: #dc3545;
            color: white;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .quantity-controls button {
            width: 25px;
            height: 25px;
            font-size: auto;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            margin: 0 5px;
            cursor: pointer;
            text-align: center;
        }

        .quantity-controls button:hover {
            background-color: #0056b3;
        }
        .quantity-display {
            font-size: 1.2rem;
            font-weight: bold;
            margin-left: 10px;
        }
        .quantity-controls .delete-mode {
            background-color: #dc3545;
        }
        .quantity-controls .delete-mode:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Order Recap</h1>
        <div id="order-container" class="row"></div>
        <div class="text-center mt-4">
            <a href="/new_order" class="btn btn-primary">Add New Order</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let orders = [
                {
                    name: "John Doe",
                    pizzas: [
                        {
                            name: "Margherita",
                            quantity: 2,
                            image: "margherita.jpg",
                            supplements: ["Extra Cheese", "Olives"],
                            excluded_ingredients: ["Tomatoes"]
                        },
                        {
                            name: "Pepperoni",
                            quantity: 1,
                            image: "pepperoni.jpg",
                            supplements: ["Mushrooms"],
                            excluded_ingredients: ["Onions"]
                        },
                        {
                            name: "Pepperoni",
                            quantity: 1,
                            image: "pepperoni.jpg",
                            supplements: [],
                            excluded_ingredients: ["Onions"]
                        }, 
                        {
                            name: "Pepperoni",
                            quantity: 1,
                            image: "pepperoni.jpg",
                            supplements: ["Mushrooms"],
                            excluded_ingredients: []
                        }
                    ]
                }
            ];

            const orderContainer = document.getElementById('order-container');

            function updateOrderDisplay() {
                orderContainer.innerHTML = '';
                orders.forEach(order => {
                    order.pizzas.forEach((pizza, pizzaIndex) => {
                        const card = document.createElement('div');
                        card.classList.add('card', 'order-card', 'col-12', 'col-sm-6', 'col-md-3');

                        const img = document.createElement('img');
                        img.src = `/static/images/${pizza.image}`;
                        img.alt = pizza.name;

                        const detailsDiv = document.createElement('div');
                        detailsDiv.classList.add('order-details');

                        const pizzaTitle = document.createElement('div');
                        pizzaTitle.classList.add('pizza-title');
                        pizzaTitle.innerText = pizza.name;

                        const quantityDisplay = document.createElement('span');
                        quantityDisplay.classList.add('quantity-display');
                        quantityDisplay.innerText = ` (x${pizza.quantity})`;

                        pizzaTitle.appendChild(quantityDisplay);

                        const quantityControls = document.createElement('div');
                        quantityControls.classList.add('quantity-controls');
                        
                        const plusButton = document.createElement('button');
                        plusButton.innerText = '+';
                        plusButton.addEventListener('click', function() {
                            pizza.quantity++;
                            quantityDisplay.innerText = ` (x${pizza.quantity})`;
                            minusButton.classList.remove('delete-mode');
                        });

                        const minusButton = document.createElement('button');
                        minusButton.innerText = '-';
                        minusButton.addEventListener('click', function() {
                            if (pizza.quantity > 1) {
                                pizza.quantity--;
                                quantityDisplay.innerText = ` (x${pizza.quantity})`;
                            } else {
                                const confirmDelete = window.confirm("Are you sure you want to remove the last pizza?");
                                if (confirmDelete) {
                                    order.pizzas.splice(pizzaIndex, 1);
                                    updateOrderDisplay();
                                }
                            }

                            if (pizza.quantity === 1) {
                                minusButton.classList.add('delete-mode');
                            } else {
                                minusButton.classList.remove('delete-mode');
                            }
                        });

                        if (pizza.quantity === 1) {
                            minusButton.classList.add('delete-mode');
                        }

                        quantityControls.appendChild(minusButton);
                        quantityControls.appendChild(plusButton);

                        const supplementsContainer = document.createElement('div');
                        pizza.supplements.forEach(supplement => {
                            const supplementTag = document.createElement('span');
                            supplementTag.classList.add('supplement');
                            supplementTag.innerText = supplement;
                            supplementsContainer.appendChild(supplementTag);
                        });

                        const excludedIngredientsContainer = document.createElement('div');
                        pizza.excluded_ingredients.forEach(ingredient => {
                            const ingredientTag = document.createElement('span');
                            ingredientTag.classList.add('excluded-ingredient');
                            ingredientTag.innerText = ingredient;
                            excludedIngredientsContainer.appendChild(ingredientTag);
                        });
                        const sizeOptionsDiv = document.createElement('div');

                        sizeOptionsDiv.classList.add('size-options');

                        const sizeLabels = ['P', 'M', 'G'];
                        sizeLabels.forEach(sizeLabel => {
                            const input = document.createElement('input');
                            input.type = 'radio';
                            input.id = sizeLabel.toLowerCase();
                            input.name = 'size';
                            input.value = sizeLabel.toLowerCase();
                            
                            const label = document.createElement('label');
                            label.setAttribute('for', sizeLabel.toLowerCase());
                            label.textContent = sizeLabel;

                            sizeOptionsDiv.appendChild(input);
                            sizeOptionsDiv.appendChild(label);
                        });

                        detailsDiv.appendChild(sizeOptionsDiv);
                        detailsDiv.appendChild(pizzaTitle);
                        detailsDiv.appendChild(supplementsContainer);
                        detailsDiv.appendChild(excludedIngredientsContainer);

                        card.appendChild(img);
                        card.appendChild(detailsDiv);
                        card.appendChild(quantityControls);

                        orderContainer.appendChild(card);
                    });
                });
            }

            updateOrderDisplay();
        });
    </script>
</body>
</html>
